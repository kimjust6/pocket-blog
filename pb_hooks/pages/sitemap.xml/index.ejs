<script server>
    const client = pb({ request })
    const blogposts = client.collection('blogposts').getFullList({
        sort: '-updated',
        filter: 'isDeleted = false',
    })

    response.header('Content-Type', 'application/xml')

    const rootpage = `
    <url>
        <loc>https://blog.jkim.win/</loc>
            <priority>1.00</priority>
            <changefreq>weekly</changefreq>
    </url>`
    const xmlBlogposts = blogposts
        ?.map(
            (post) =>
                `
        <url>
            <loc>https://blog.jkim.win/blog/posts/${post?.id}</loc>
            <lastmod>${new Date(post?.updated).toISOString()}</lastmod>
            <changefreq>weekly</changefreq>
            <priority>0.80</priority>
        </url>
    `
        )
        .join('')
    const xmlSnippet = `

    <urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
        ${rootpage}
        ${xmlBlogposts}
    </urlset>
    `
    response.write(xmlSnippet)
</script>
